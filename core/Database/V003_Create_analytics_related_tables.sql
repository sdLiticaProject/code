CREATE TABLE `sdliticadb`.`ANALYTICS_MODULES` (
  `ID` VARCHAR(36) NOT NULL,
  `LAST_HEARD_TIME` DATETIME,
  CONSTRAINT `ANALYTICS_MODULES_PK`
    PRIMARY KEY(`ID`)
) ENGINE = InnoDB;

CREATE TABLE `sdliticadb`.`ANALYTICS_OPERATIONS` (
  `ID` VARCHAR(36) NOT NULL,
  `NAME` VARCHAR(40) NOT NULL UNIQUE,
  `DESCRIPTION` VARCHAR(40),
  `ROUTING_KEY` VARCHAR(40) NOT NULL,
  CONSTRAINT `ANALYTICS_OPERATIONS_PK`
    PRIMARY KEY(`ID`)
) ENGINE = InnoDB;

CREATE TABLE `sdliticadb`.`ANALYTICS_MODULES_OPERATIONS` (
  `ID` VARCHAR(36) NOT NULL,
  `ANALYTICS_OPERATION_ID` VARCHAR(36) NOT NULL,
  `ANALYTICS_MODULE_ID` VARCHAR(36) NOT NULL,
  `ROUTING_KEY` VARCHAR(40) NOT NULL,
  CONSTRAINT `MODULESOPERATIONS_PK`
    PRIMARY KEY(`ID`),
  CONSTRAINT `MODULESOPERATIONS_OPERATIONS_FK`
    FOREIGN KEY (`ANALYTICS_OPERATION_ID`)
    REFERENCES `sdliticadb`.`ANALYTICS_OPERATIONS` (`ID`)
    ON DELETE CASCADE,
  CONSTRAINT `MODULESOPERATIONS_MODULES_FK`
    FOREIGN KEY (`ANALYTICS_MODULE_ID`)
    REFERENCES `sdliticadb`.`ANALYTICS_MODULES` (`ID`)
    ON DELETE CASCADE
) ENGINE = InnoDB;

CREATE TABLE `sdliticadb`.`TIMESERIES_ANALYTICS_OPERATIONS` (
  `ID` VARCHAR(36) NOT NULL,
  `OPERATION_ID` VARCHAR(40) NOT NULL,
  `TIMESERIES_METADATA_ID` VARCHAR(36) NOT NULL,
  `STATUS` TINYINT,
  `ARGUMENTS` JSON,
  CONSTRAINT `USER_ANALYTICS_OPERATION_PK`
    PRIMARY KEY(`ID`),
  CONSTRAINT `TIMESERIES_METADATA_FK`
    FOREIGN KEY(`USER_ID`)
    REFERENCES `sdliticadb`.`TIMESERIES_METADATA` (`ID`)
    ON DELETE CASCADE
    ON UPDATE RESTRICT,
  CONSTRAINT `ANALYTICS_OPERATION_FK`
    FOREIGN KEY(`OPERATION_ID`)
    REFERENCES `sdliticadb`.`ANALYTICS_OPERATIONS` (`ID`)
    ON DELETE CASCADE
    ON UPDATE RESTRICT,
) ENGINE = InnoDB;
